# åŸºäºUNetçš„è¡—æ™¯å›¾åƒåˆ†å‰²é¡¹ç›®

æœ¬é¡¹ç›®å®ç°äº†åŸºäºUNetæ¶æ„çš„è¡—æ™¯å›¾åƒåˆ†å‰²æ–¹æ³•ï¼Œä¸»è¦é’ˆå¯¹CamVidæ•°æ®é›†è¿›è¡Œé¢„è®­ç»ƒã€è·¨åŸŸé€‚åº”å’Œå°ç›®æ ‡ä¼˜åŒ–å®éªŒã€‚

## ğŸš€ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä¸‰ä¸ªä¸»è¦å®éªŒéƒ¨åˆ†ï¼š
- **Part 1**: é¢„è®­ç»ƒå’Œè¯„ä¼°ï¼ˆSunnyæ•°æ®é›†ï¼‰
- **Part 2**: è·¨åŸŸé€‚åº”å®éªŒï¼ˆCloudyæ•°æ®é›†ï¼‰  
- **Part 3**: å°ç›®æ ‡åˆ†å‰²ä¼˜åŒ–

é¡¹ç›®æ”¯æŒä¸¤ç§UNetæ¨¡å‹ï¼š
- æ ‡å‡†UNet
- æ”¹è¿›çš„UNetï¼ˆå¢å¼ºå°ç›®æ ‡åˆ†å‰²èƒ½åŠ›ï¼‰

## ğŸ“Š æ•°æ®é›†

é¡¹ç›®ä½¿ç”¨CamVidæ•°æ®é›†ï¼ŒåŒ…å«14ä¸ªè¯­ä¹‰åˆ†å‰²ç±»åˆ«ï¼š
- Sky, Building, Pole, Road, LaneMarking, SideWalk, Pavement
- Tree, SignSymbol, Fence, Car_Bus, Pedestrian, Bicyclist, Unlabelled

æ•°æ®é›†åŒ…å«ä¸¤ç§å¤©æ°”æ¡ä»¶ï¼š
- **Sunny**: æ™´å¤©åœºæ™¯
- **Cloudy**: å¤šäº‘åœºæ™¯

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚
- Python 3.10+
- CUDA 11.8+ 
- Windows 10/11 æˆ– Linux

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨Condaç¯å¢ƒ (æ¨è)

1. **å®‰è£…Anacondaæˆ–Miniconda**
   ```bash
   # ä¸‹è½½å¹¶å®‰è£…Anaconda
   # https://www.anaconda.com/products/distribution
   ```

2. **åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ**
   ```bash
   # ä½¿ç”¨environment.ymlåˆ›å»ºç¯å¢ƒ
   conda env create -f environment.yml
   
   # æ¿€æ´»ç¯å¢ƒ
   conda activate unet
   ```

### æ–¹æ³•äºŒï¼šä½¿ç”¨pipå®‰è£…

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
   ```bash
   python -m venv unet_env
   
   # Windows
   unet_env\Scripts\activate
   
   # Linux/Mac
   source unet_env/bin/activate
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

### æ ¸å¿ƒä¾èµ–åŒ…

- **æ·±åº¦å­¦ä¹ æ¡†æ¶**: PyTorch 2.4.1
- **å›¾åƒå¤„ç†**: PIL, OpenCV, scikit-image
- **æ•°æ®ç§‘å­¦**: NumPy, Matplotlib, tqdm
- **å…¶ä»–**: colorama, networkx

## ğŸ“ é¡¹ç›®ç»“æ„

```
M/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–åŒ…
â”œâ”€â”€ environment.yml             # Condaç¯å¢ƒé…ç½®
â”œâ”€â”€ config.py                   # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ run.py                      # ä¸»å®éªŒè¿è¡Œè„šæœ¬
â”œâ”€â”€ æŠ€æœ¯æŠ¥å‘Š.md                  # è¯¦ç»†æŠ€æœ¯æŠ¥å‘Š
â”‚
â”œâ”€â”€ CamVid/                     # æ•°æ®é›†ç›®å½•
â”‚   â”œâ”€â”€ sunny/                  # æ™´å¤©æ•°æ®
â”‚   â””â”€â”€ cloudy/                 # å¤šäº‘æ•°æ®
â”‚
â”œâ”€â”€ models/                     # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ unet.py                 # æ ‡å‡†UNet
â”‚   â””â”€â”€ improved_unet.py        # æ”¹è¿›UNet
â”‚
â”œâ”€â”€ data/                       # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ dataset.py              # æ•°æ®é›†ç±»
â”‚   â”œâ”€â”€ augmentation.py         # æ•°æ®å¢å¼º
â”‚   â””â”€â”€ statistics/             # æ•°æ®ç»Ÿè®¡
â”‚
â”œâ”€â”€ losses/                     # æŸå¤±å‡½æ•°
â”‚   â””â”€â”€ losses.py               # å„ç§æŸå¤±å‡½æ•°å®ç°
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ metrics.py              # è¯„ä¼°æŒ‡æ ‡
â”‚   â”œâ”€â”€ training.py             # è®­ç»ƒå·¥å…·
â”‚   â”œâ”€â”€ object_metrics.py       # ç›®æ ‡çº§æŒ‡æ ‡
â”‚   â””â”€â”€ visualization.py        # å¯è§†åŒ–å·¥å…·
â”‚
â”œâ”€â”€ outputs/                    # å®éªŒç»“æœ
â”‚   â”œâ”€â”€ part1_pretrain_evaluation/
â”‚   â”œâ”€â”€ part2_domain_adaptation/
â”‚   â””â”€â”€ part3_small_object_optimization/
â”‚
â””â”€â”€ visualization/              # é¢„æµ‹ç»“æœå¯è§†åŒ–
    â”œâ”€â”€ unet_predictions/
    â””â”€â”€ improved_unet_predictions/
```

## ğŸƒâ€â™‚ï¸ è¿è¡ŒæŒ‡å—

### å®Œæ•´å®éªŒæµç¨‹

ä½¿ç”¨ä¸»è„šæœ¬è¿è¡Œæ‰€æœ‰ä¸‰ä¸ªéƒ¨åˆ†çš„å®éªŒï¼š

```bash
python run.py
```

### åˆ†æ­¥éª¤è¿è¡Œ

#### Part 1: é¢„è®­ç»ƒå’Œè¯„ä¼°
```bash
python part1_pretrain_evaluation.py
```
- åœ¨Sunnyæ•°æ®é›†ä¸Šè®­ç»ƒUNetæ¨¡å‹
- è¯„ä¼°æ¨¡å‹æ€§èƒ½å¹¶ç”Ÿæˆå¯è§†åŒ–ç»“æœ
- ä¿å­˜æœ€ä½³æ¨¡å‹æƒé‡

#### Part 2: è·¨åŸŸé€‚åº”å®éªŒ
```bash
python part2_domain_adaptation.py
```
- ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹åœ¨Cloudyæ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒ
- æ¯”è¾ƒä¸åŒæŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨çš„æ•ˆæœ
- ç”Ÿæˆè·¨åŸŸé€‚åº”æ€§èƒ½æŠ¥å‘Š

#### Part 3: å°ç›®æ ‡ä¼˜åŒ–
```bash
python part3_small_object_optimization.py
```
- é’ˆå¯¹å°ç›®æ ‡ç±»åˆ«ï¼ˆCar_Bus, LaneMarking, Pedestrianï¼‰è¿›è¡Œä¼˜åŒ–
- æ¯”è¾ƒæ ‡å‡†UNetå’Œæ”¹è¿›UNetçš„æ€§èƒ½
- ç”Ÿæˆå°ç›®æ ‡åˆ†å‰²æ”¹è¿›åˆ†æ

### å•ç‹¬é¢„æµ‹
```bash
python predict_and_save.py
```

### é…ç½®å‚æ•°

ä¸»è¦é…ç½®å‚æ•°åœ¨ `config.py` ä¸­è®¾ç½®ï¼š

```python
# æ•°æ®è·¯å¾„
DATA_ROOT_SUNNY = 'CamVid/sunny'
DATA_ROOT_CLOUDY = 'CamVid/cloudy'

# å›¾åƒå°ºå¯¸
IMG_SIZE = [384, 384]

# ç±»åˆ«æ•°é‡
NUM_CLASSES = 14

# å°ç›®æ ‡ç±»åˆ«
SMALL_OBJECT_CLASSES = ['Car_Bus', 'LaneMarking', 'Pedestrian', ...]
```

## ğŸ“ˆ å®éªŒç»“æœ

### Part 1: é¢„è®­ç»ƒç»“æœ
- æ¨¡å‹åœ¨Sunnyæ•°æ®é›†ä¸Šçš„åŸºå‡†æ€§èƒ½
- å„ç±»åˆ«çš„åˆ†å‰²ç²¾åº¦å’ŒIoUæŒ‡æ ‡
- æœ€ä½³å’Œæœ€å·®é¢„æµ‹æ ·ä¾‹å±•ç¤º

### Part 2: è·¨åŸŸé€‚åº”ç»“æœ
- ä¸åŒæŸå¤±å‡½æ•°ï¼ˆCE Loss, Dice Loss, Combined Lossï¼‰çš„æ¯”è¾ƒ
- ä¸åŒä¼˜åŒ–å™¨ï¼ˆAdam, AdamW, SGD, ASGDï¼‰çš„æ€§èƒ½å¯¹æ¯”
- è®­ç»ƒå’ŒéªŒè¯æŒ‡æ ‡çš„å¯¹æ¯”åˆ†æ

### Part 3: å°ç›®æ ‡ä¼˜åŒ–ç»“æœ
- æ”¹è¿›UNetåœ¨å°ç›®æ ‡åˆ†å‰²ä¸Šçš„æå‡æ•ˆæœ
- Car_Bus, LaneMarking, Pedestrianç±»åˆ«çš„è¯¦ç»†åˆ†æ
- åŸºçº¿æ¨¡å‹ä¸æ”¹è¿›æ¨¡å‹çš„æ€§èƒ½å¯¹æ¯”

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CUDAå†…å­˜ä¸è¶³**
   ```bash
   # å‡å°batch size
   # åœ¨config.pyä¸­è°ƒæ•´BATCH_SIZEå‚æ•°
   ```

2. **æ•°æ®é›†è·¯å¾„é”™è¯¯**
   ```bash
   # ç¡®ä¿CamVidæ•°æ®é›†æ­£ç¡®æ”¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•
   # æ£€æŸ¥config.pyä¸­çš„è·¯å¾„é…ç½®
   ```

3. **ä¾èµ–åŒ…ç‰ˆæœ¬å†²çª**
   ```bash
   # å»ºè®®ä½¿ç”¨condaç¯å¢ƒéš”ç¦»
   conda env create -f environment.yml
   ```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- ä½¿ç”¨GPUåŠ é€Ÿè®­ç»ƒï¼ˆéœ€è¦CUDAæ”¯æŒï¼‰
- æ ¹æ®æ˜¾å­˜å¤§å°è°ƒæ•´batch_size
- ä½¿ç”¨æ•°æ®å¹¶è¡Œè®­ç»ƒåŠ é€Ÿ

## ğŸ“ æŠ€æœ¯æŠ¥å‘Š

è¯¦ç»†çš„æŠ€æœ¯å®ç°å’Œå®éªŒåˆ†æè¯·å‚è€ƒ `æŠ€æœ¯æŠ¥å‘Š.md` æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡Issueæˆ–é‚®ä»¶è”ç³»ã€‚

---

**æœ€åæ›´æ–°**: 2025å¹´6æœˆ27æ—¥
